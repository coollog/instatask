<style>
  #map {
    width: 100%;
    height: 500px;
  }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<script>
  var directionsDisplay, directionsService;

  var selfMarker = null;
  var otherMarker = null;
  var locations = [
    '15 Prospect St, New Haven, CT 06520',
    '33 Lynwood Place, New Haven, CT 06520',
    '205 Elm St, New Haven, CT 06520'
  ];

  function initMap() {
    directionsService = new google.maps.DirectionsService;
    directionsDisplay = new google.maps.DirectionsRenderer;

    var mapOptions = {
        center: new google.maps.LatLng(41.311177, -72.925767),
        zoom: 17,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map"), mapOptions);

    directionsDisplay.setMap(map);

    selfMarker = new google.maps.Marker({
      position: new google.maps.LatLng(41.311177, -72.925767),
      map: map,
      title: "This is a marker!",
      animation: google.maps.Animation.DROP
    });

    otherMarker = new google.maps.Marker({
      position: new google.maps.LatLng(41.311177, -72.925767),
      map: map,
      title: "This is a marker!",
      animation: google.maps.Animation.DROP
    });
  }

  function calcRoute() {
    var waypoints = [];
    for (var i = 1; i < locations.length - 1; i ++) {
      waypoints.push({
        location: locations[i],
        stopover: true
      });
    }
    var request = {
      origin: locations[0],
      destination: locations[locations.length-1],
      waypoints: waypoints,
      travelMode: 'WALKING'
    };
    directionsService.route(request, function(result, status) {
      if (status == 'OK') {
        directionsDisplay.setDirections(result);
      }
    });
  }

  function myPosition(callback) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var latitude = position.coords.latitude;
      var longitude = position.coords.longitude;
      callback(latitude, longitude);
    });
  }

  function moveSelfMarker() {
    myPosition(function(latitude, longitude) {
      if (selfMarker) {
        selfMarker.setPosition(new google.maps.LatLng(latitude, longitude));
      }
      setTimeout(moveSelfMarker, 1000);
    });
  }

  function otherPosition(callback) {
    $.get('/workerlocation')
      .done(function(data) {
        var latitude = data.latitude;
        var longitude = data.longitude;
        callback(latitude, longitude);
      });
  }

  function moveOtherMarker() {
    otherPosition(function(latitude, longitude) {
      if (otherMarker) {
        otherMarker.setPosition(new google.maps.LatLng(latitude, longitude));
      }
      setTimeout(moveOtherMarker, 1000);
    });
  }

  function getLocations() {
    $.get('/workinglocations')
      .done(function(data) {
        console.log(data);
      });
  }

  $(function() {
    $('#finish').click(function() {
      $.get('/finishworking')
        .done(function() {
          $('#main').html('FINISHED');
        });
    });

    moveSelfMarker();
    moveOtherMarker();
  });
</script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4QjkNoJWuM8oT7NwKN-EoAgsUdYzVYVM&callback=initMap"></script>

<div id="main">

  <div id="map"></div>

  <button id="finish">Finished</button>

</div>