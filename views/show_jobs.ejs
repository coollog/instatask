<!DOCTYPE html>
<style>
  #map {
    width: 100%;
    height: 500px;
  }
</style>

<div id="main">
  <div id="map"></div>
  <button id="finish">Finished</button>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<script src="http://maps.google.com/maps/api/js?sensor=false" 
          type="text/javascript"></script>



<script type="text/javascript">

/*
[{"_id":"5817f29963eb2151c74a66b1","title":"TourGuide","employer":"Young Josh","employee":"","description":"Guidetour to a Museum","location":"41.311067, -72.915767","status":"Waiting"},{"_id":"5817f2ec63eb2151c74a66b2","title":"Do an experiment","employer":"Hush Baby","employee":"Gao","description":"Do an experiment on HCI","location":"41.311067, -72.915767","status":"Working"},{"_id":"5817f32963eb2151c74a66b3","title":"Do a MRI experiment","employer":"Professor Zhang","employee":"Oliver","description":"Do a scan of MRI","location":"41.311067, -72.915567","status":"Done"}]

*/
 
  var dbTaskResult = '<%- JSON.stringify(dbTaskResult) %>'.slice(2, -2);
  var taskArray = dbTaskResult.split("},{");
  var locations = taskArray;
  for (var i = 0; i < taskArray.length; i++){
    taskArray[i] = taskArray[i].split(",");
    //alert(taskArray[i][1] + taskArray[i][5] + taskArray[i][6]);
    locations[i] = [taskArray[i][1].split(':')[1].slice(1, -1), 
                        taskArray[i][5].split(':')[1].slice(1, -1), 
                        taskArray[i][6].split(':')[1].slice(1, -1)];
    alert(locations[i]);

  }


  /*
  var locations = [
    ['SOM', 41.311277, -72.925267, 4],
    ['Law School', 41.311977, -72.925727, 5],
    ['School of music', 41.311117, -72.920765, 3],
    ['School of drama', 41.311187, -72.925767, 2],
    ['School of engineering', 41.312177, -72.925662, 1]
  ]; 
  */

  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 16,
    center: new google.maps.LatLng(41.311177, -72.925767),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });

  var infowindow = new google.maps.InfoWindow();// show information of each location
  
  // create pin for each location
  for (var i = 0; i < locations.length; i++) {  
    var marker = new google.maps.Marker({
      position: new google.maps.LatLng(locations[i][1], locations[i][2]),
      map: map
    });

    google.maps.event.addListener(marker, 'mouseover', (function(marker, i) {
      return function() {
        infowindow.setContent(locations[i][0]);
        infowindow.open(map, marker);
      }
    })(marker, i));
  } 
</script>