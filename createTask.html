<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4QjkNoJWuM8oT7NwKN-EoAgsUdYzVYVM"></script>
    <style type="text/css">
        body {
            font: helvetica;
            font-size: 14px;
        }
        
        .mapdiv {
            width: 100%;
            height: 400px;
        }
        
        .inputBox {
            width: 50%;
            margin: 5px;
            display: block;
        }
        
        .button {
            background-color: rgba(65, 174, 65, 1);
            color: white;
            margin: 5px;
            padding: 5px 40px;
            font-size: 16px;
            border: none;
        }
    </style>
    <script>
        function currentLatLong(callback) {
            var x = document.getElementById("demo");
            var latlong = [];
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(success, error);
            }
            else {
                x.innerHTML = "Default coordinates";
                latlong.push(41.3154);
                latlong.push(-72.9204);
                return callback(latlong);
            }

            function success(position) {
                x.innerHTML = "Your coordinates";
                latlong.push(position.coords.latitude);
                latlong.push(position.coords.longitude);
                return callback(latlong);
            }

            function error(err) {
                x.innerHTML = "Default coordinates";
                latlong.push(41.3154);
                latlong.push(-72.9204);
                return callback(latlong);
            };
        };
        var marker;

        function myMap() {
            var y = document.getElementById("test");
            var mapCanvas = document.getElementById("map");
            currentLatLong(function(latlong) {
                var mapOptions = {
                    center: new google.maps.LatLng(latlong[0], latlong[1]),
                    zoom: 17
                }
                var map = new google.maps.Map(mapCanvas, mapOptions);
                marker = new google.maps.Marker({
                    position: mapOptions.center,
                    title: "Set Task Location",
                    draggable: true
                });
                marker.setMap(map);
                google.maps.event.addListener(marker, 'dragend', function(event) {
                    y.innerHTML = this.getPosition().lat() + ", " + this.getPosition().lng();
                });
                y.innerHTML = marker.getPosition().lat() + ", " + marker.getPosition().lng();
            });
        }

        $(document).ready(function() {
            myMap();
        });
        $(document).ready(function() {
            $("#taskSubmit").click(function() {
                $(this).hide();
                var jobHeading = $('input[name=job_heading]').val();
                var jobDesc = $('textarea[name=job_description]').val();
                var pay = $('input[name=pay]').val();
                var lat = marker.getPosition().lat();
                var lng = marker.getPosition().lng();

                $.post('/postTask', {
                    jobHeading: jobHeading,
                    jobDesc: jobDesc,
                    pay: pay,
                    lat: lat,
                    lng: lng
                });
            });
        });
    </script>
</head>

<body>
    <div id="map" class="mapdiv"></div>
    <p id="demo"></p>
    <p id="test"></p>
    <input required class="inputBox" type="text" name="job_heading" placeholder="Enter job title" id="jobHeading" />
    <textarea class="inputBox" name="job_description" placeholder="Enter job description" id="jobDesc"></textarea>
    <input class="inputBox" required type="number" name="pay" placeholder="0.00" min="0" step="0.1">
    <input type="submit" class="button" id="taskSubmit" value="Next" />
</body>

</html>